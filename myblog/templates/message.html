{% extends "base.html" %}

{% block title %}
给我留言
{% endblock %}
{% block link %}
    <link href="/statics/css/jquery.slideBox.css" rel="stylesheet" type="text/css" />
    <link href="/statics/css/pgwslider.css" rel="stylesheet">
{% endblock %}
{% block container %}
<article>
  <aside class="l_box">
    <div class="about_me">
          <div>
              <h2>关于我</h2>
              <hr>
              <a style="left: 25px" href="https://weibo.com/liujing0824" target="_blank"><img src="/statics/images/weibo.png"></a>
              <a style="left: 110px" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=liucjing@foxmail.com" target="_blank"><img src="/statics/images/email.png"></a></span>
              <a style="left: 195px" id="littleimg" onmouseleave="hoverHiddendiv()" onmouseenter="hoverShowDiv()" href=""><img src="/statics/images/weixin.png"></a>
              <a style="left: 280px" href="https://github.com/rskdst" target="_blank"><img src="/statics/images/github.png"></a>
          </div>
      </div>
    <div>
        <img style="display: none" id="divHover" img src="/statics/images/hover.png">
        <img style="display: none" id="weixin" src="/statics/images/wxqr.jpg">
    </div>
    <div class="rmwz">
          <div class="hot-article">
            <h2>热门文章</h2>
              <hr>
            <div id="demo1" class="slideBox">
              <ul class="items">
                  {% for hot_article in hot_article_list %}
                    <li><a href="/detail/?article_id={{ hot_article.id }}" title="{{ hot_article.title }}" target="_blank"><img src="/statics/images/article_picture/{{ hot_article.article_picture }}"></a></li>
                  {% endfor %}
              </ul>
            </div>
          </div>
      </div>
     <div class="search">
      <form action="/search/" method="get" name="searchform" id="searchform">
          {% if key_word %}
            <input name="keyboard" id="keyboard" class="input_text" value={{ key_word }} style="color: rgb(153, 153, 153);" onfocus="if(value=={{ key_word }}){this.style.color='#000';value=''}" onblur="if(value==''){this.style.color='#999';value={{ key_word }}" type="text">
          {% else %}
              <input name="keyboard" id="keyboard" class="input_text" value="请输入关键字词" style="color: rgb(153, 153, 153);" onfocus="if(value=='请输入关键字词'){this.style.color='#000';value=''}" onblur="if(value==''){this.style.color='#999';value='请输入关键字词'}" type="text">
          {% endif %}
        <input name="Submit" class="input_submit" value="搜索" type="submit">
      </form>
    </div>
   <div class="fenlei" style="overflow: visible">
      <div>
        <h2>文章分类</h2>
        <hr>
        <ul>
          {% for tag_obj in data.tag_obj_list %}
              {% if tag_obj.name == "站长推荐" %}
                  <li style="display: none"></li>
              {% else %}
                  {% if tag_id %}
                      {% if tag_obj.id == tag_id %}
                          <li><a style="color: red" href="/article/tag/?tag_id={{ tag_obj.id }}">{{ tag_obj.name }}({{ tag_obj.article.filter_by(article_status="发布").all() | length }})</a></li>
                      {% else %}
                          <li><a href="/article/tag/?tag_id={{ tag_obj.id }}">{{ tag_obj.name }}({{ tag_obj.article.filter_by(article_status="发布").all() | length }})</a></li>
                      {% endif %}
                  {% else %}
                      <li><a href="/article/tag/?tag_id={{ tag_obj.id }}">{{ tag_obj.name }}({{ tag_obj.article.filter_by(article_status="发布").all() | length }})</a></li>
                  {% endif %}
              {% endif %}
          {% endfor %}
        </ul>
      </div>
    </div>
    <div class="guanzhu" style="overflow: visible">
        <div>
            <h2>关注我 么么哒</h2>
            <hr>
            <ul>
              <img src="/statics/images/wxqr.jpg">
            </ul>
        </div>
    </div>
  </aside>
  <main class="r_box">
  <header class="leaveword-header">
      <h2><a href="#msg">给我留言</a></h2>
  </header>
  <div class="comments"><img style="display: inline" src="/statics/images/leave_word.png"><b>({{ leave_message_count }})</b>个小伙伴在吐槽</div>
<div class="gbook">
    {% for messages in data.data_list %}
      <div class="fb">
        <ul>
          <p class="fbtime"><span> {{ messages.message.created_date }} </span> {{ messages.message.user.username }}</p>
          <p class="fbinfo">{{ messages.message.content }}</p>
        </ul>
      </div>
        {% if messages.reply == None %}
        {% else %}
          <div class="hf">
            <ul>
              <p class="zzhf"><font color="#FF0000">站长回复:</font>{{ messages.reply.content }}</p>
            </ul>
          </div>
        {% endif %}
    {% endfor %}
     <div class="pagelist">
        {% if data.pre_page %}
            <a href="/message/?page={{ data.pre_page }}">上一页</a>
        {% else %}
            <a href="#">上一页</a>
        {% endif %}
        {% for page in data.page_range %}
            {% if page == data.current_page %}
                <a href="#" class="curPage">{{ page }}</a>&nbsp;&nbsp;
            {% else %}
                <a href="/message/?page={{ page }}">{{ page }}</a>
            {% endif %}
        {% endfor %}
        {% if data.next_page %}
            <a href="/message/?page={{ data.next_page }}">下一页</a>
        {% else %}
            <a href="#">下一页</a>
        {% endif %}
    </div>
      <div class="gbox" id="msg">
        <form method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <p> <strong>来说点儿什么吧...</strong></p>
          <p class="yname"><span>昵&nbsp;&nbsp;&nbsp;&nbsp;称:</span>
            <input name="username" type="text" class="inputText" id="username" value="" size="16">
          </p>
            <p class="yemail"><span>邮&nbsp;&nbsp;&nbsp;&nbsp;箱:</span>
            <input name="email" type="email" class="inputText" id="email" value="" size="16">
          </p>
          <p class="yzm"><span>验证码:</span>
              <input type="text" value="" placeholder="请输入验证码（不区分大小写）" class="input-val">
              <canvas id="canvas" width="100" height="30"></canvas>
          </p>
          <p><span class="tnr">留言内容:</span>
            <textarea name="content" cols="60" rows="12" id="lytext"></textarea>
          </p>
          <p>
            <input type="button" class="add_message" name="submit" value="提交">
          </p>
        </form>
      </div>
    </div>
  </main>
</article>
{% endblock %}
{% block script %}
    <script src="/statics/js/jquery.min.js"></script>
    <script src="/statics/js/pgwslider.js"></script>
    <script src="/statics/js/jquery.slideBox.min.js" type="text/javascript"></script>
     <script type="text/javascript">
        let divHover = $("#divHover");
        let weixin = $("#weixin");
        function hoverShowDiv() {
            divHover.css("display","block");
            weixin.css("display","block");
            divHover.addClass("hover-img");
            weixin.addClass("weixin");
        }
        function hoverHiddendiv() {
            weixin.removeClass("weixin");
            divHover.removeClass("hover-img");
            weixin.css("display","none");
            divHover.css("display","none");
        }
        $(document).ready(function() {
            $('.pgwSlider').pgwSlider();
            $('#demo1').slideBox();
            $('#demo3').slideBox({
                duration : 1,//滚动持续时间，单位：秒
                easing : 'linear',//swing,linear//滚动特效
                delay : 10,//滚动延迟时间，单位：秒
                hideClickBar : false,//不自动隐藏点选按键
                clickBarRadius : 10
            });

        });
        //提交验证
        $(function(){
            var show_num = [];
            draw(show_num);
            $("#canvas").on('click',function(){
                draw(show_num);
            });

            $(".add_message").on('click',function(){
                var num = show_num.join("");
                var val = $(".input-val").val().toLowerCase();
                if($("#username").val().length == 0){
                   alert("请填写昵称");
                }else if($("#email").val().length == 0){
                   alert("请填写电子邮箱");
                }else if($("#lytext").val().length == 0){
                   alert("说两句在提交吧");
                }else if(val==''){
                    alert('请输入验证码！');
                } else if(val!=num){
                    alert('验证码错误！请重新输入！');
                    $(".input-val").val('');
                    draw(show_num);
                }else {
                    $(this).attr("type","submit")
                }
            })

        });

    //生成并渲染出验证码图形
    function draw(show_num) {
        var canvas_width=$('#canvas').width();
        var canvas_height=$('#canvas').height();
        var canvas = document.getElementById("canvas");//获取到canvas的对象，演员
        var context = canvas.getContext("2d");//获取到canvas画图的环境，演员表演的舞台
        canvas.width = canvas_width;
        canvas.height = canvas_height;
        var sCode = "a,b,c,d,e,f,g,h,i,j,k,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0";
        var aCode = sCode.split(",");
        var aLength = aCode.length;//获取到数组的长度

        for (var i = 0; i < 4; i++) {  //这里的for循环可以控制验证码位数（如果想显示6位数，4改成6即可）
            var j = Math.floor(Math.random() * aLength);//获取到随机的索引值
            // var deg = Math.random() * 30 * Math.PI / 180;//产生0~30之间的随机弧度
            var deg = Math.random() - 0.5; //产生一个随机弧度
            var txt = aCode[j];//得到随机的一个内容
            show_num[i] = txt.toLowerCase();
            var x = 10 + i * 20;//文字在canvas上的x坐标
            var y = 20 + Math.random() * 8;//文字在canvas上的y坐标
            context.font = "bold 23px 微软雅黑";

            context.translate(x, y);
            context.rotate(deg);

            context.fillStyle = randomColor();
            context.fillText(txt, 0, 0);

            context.rotate(-deg);
            context.translate(-x, -y);
        }
        for (var i = 0; i <= 5; i++) { //验证码上显示线条
            context.strokeStyle = randomColor();
            context.beginPath();
            context.moveTo(Math.random() * canvas_width, Math.random() * canvas_height);
            context.lineTo(Math.random() * canvas_width, Math.random() * canvas_height);
            context.stroke();
        }
        for (var i = 0; i <= 30; i++) { //验证码上显示小点
            context.strokeStyle = randomColor();
            context.beginPath();
            var x = Math.random() * canvas_width;
            var y = Math.random() * canvas_height;
            context.moveTo(x, y);
            context.lineTo(x + 1, y + 1);
            context.stroke();
        }
    }

    //得到随机的颜色值
    function randomColor() {
        var r = Math.floor(Math.random() * 256);
        var g = Math.floor(Math.random() * 256);
        var b = Math.floor(Math.random() * 256);
        return "rgb(" + r + "," + g + "," + b + ")";
    }
    </script>
             }
{% endblock %}